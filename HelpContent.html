<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 15px; /* Add padding around content */
      background-color: <?= GlobalConfig.mainColor ?>; /* Use variable */
      color: #5b0f00; /* Dark red text */
      font-size: 10pt; /* Base font size */
      line-height: 1.4; /* Improve readability */
    }
    h2 {
      color: #5b0f00; /* Same as body */
      font-size: 1.4em; /* Slightly larger */
      border-bottom: 1px solid <?= GlobalConfig.secondaryColor ?>; /* Use variable */
      padding-bottom: 5px;
      margin-top: 0;
      margin-bottom: 15px;
    }
    h3 {
      color: #5b0f00;
      font-size: 1.2em;
      margin-top: 20px;
      margin-bottom: 10px;
    }
    p {
      margin-bottom: 1em; /* Space after paragraphs */
    }
    ul {
      list-style-type: none;
      padding: 0;
      margin: 0 0 1em 0; /* Consistent margins */
    }
    li {
       margin-bottom: 0.8em; /* Space between list items */
    }
    ol {
      padding-left: 20px; /* Standard indentation */
      margin: 0 0 1em 0;
    }
    ol li {
      margin-bottom: 0.5em;
    }
    .category-title {
      font-weight: bold;
      /* color: black; */ /* Remove if using body color */
      display: block; /* Ensure it's on its own line */
      margin-bottom: 3px; /* Small space before description */
    }
    .description {
      color: #954535; /* Slightly lighter red/brown */
      font-size: 0.95em; /* Slightly smaller */
      display: block;
      margin-left: 5px; /* Indent description slightly */
    }
    .mode-info {
        background-color: <?= GlobalConfig.secondaryColor ?>; /* Use variable */
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #e0caba;
        border-radius: 4px;
        font-style: italic;
    }
    .key-item {
        margin-bottom: 15px;
        padding-left: 5px;
    }
     code {
        background-color: #eee;
        padding: 1px 4px;
        border-radius: 3px;
        font-family: monospace;
     }
  </style>
</head>
<body>
  <!-- Display current sheet name -->
  <h2>Help: <?= sheetName ?> Sheet</h2>

  <!-- Display current mode description -->
  <? if (mode === ModeTypes.HABIT_IDEATION) { ?>
    <div class="mode-info">
      Current Mode: <b>Habit Ideation</b><br>
      You are currently setting up your habits. Define habits using emojis in the <code>activities</code> column, set your preferences, and check the 'set habits' box when done.
    </div>
    <span class="category-title">Getting Started:</span>
    <ol>
      <li>Enter your habits in the <code><?= MainSheetConfig.headerLabels.activities ?></code> column (Column <?= DataHandler._cellToA1Notation(1, MainSheetConfig.activityDataColumn).charAt(0) ?>). Use one or more emojis per habit cell. Only cells with emojis count as trackable habits.</li>
      <li>(Optional) Add non-emoji text in other cells in the activities column for labels or notes (e.g., "Morning Routine").</li>
      <li>(Optional) Add detailed descriptions to your emoji cells using Right-Click > Insert Note.</li>
      <li>Configure the <code><?= MainSheetConfig.setterLabels.resetHour ?></code> (0-23) and <code><?= MainSheetConfig.setterLabels.boostInterval ?></code> (1+) settings on the right. See notes on those cells for details.</li>
      <li>Once satisfied, check the <code><?= MainSheetConfig.setterLabels.setHabit ?></code> checkbox to finalize setup and start tracking.</li>
    </ol>
    <p><b>Tip:</b> Group related habits under the same emoji if they share the same buffer logic!</p>

  <? } else if (mode === ModeTypes.TERMINATED) { ?>
    <div class="mode-info">
      Current Mode: <b>Terminated</b><br>
      Habit tracking is currently stopped. To start again, use the menu: <b>Moderate Habits Settings > Start New Challenge</b>.
    </div>
     <p>Your past data in the 'history' sheet remains available.</p>

  <? } else if (mode === ModeTypes.CHALLENGE) { ?>
     <div class="mode-info">
      Current Mode: <b>Challenge</b><br>
      You are actively tracking your habits. Mark completion checkboxes daily and use the date selector to view past days.
    </div>

    <!-- Content specific to the sheet being viewed in Challenge Mode -->
    <? if (sheetName === MainSheetConfig.sheetName) { ?>
      <h3>Main Sheet Overview</h3>
      <p>This sheet shows your habit status for the selected date. Use the <code><?= MainSheetConfig.headerLabels.dateSelector ?></code> cell (<?= MainSheetConfig.dateCell ?>) to navigate between days. Data automatically saves when you change dates or mark habits complete.</p>
      <ul>
        <li><span class="category-title"><?= MainSheetConfig.headerLabels.activities ?> (Column <?= DataHandler._cellToA1Notation(1, MainSheetConfig.activityDataColumn).charAt(0) ?>)</span>
          <span class="description">Your defined habits (emojis) and any optional labels.</span>
        </li>
        <li><span class="category-title"><?= MainSheetConfig.headerLabels.completion ?> (Column <?= DataHandler._cellToA1Notation(1, MainSheetConfig.completionDataColumn).charAt(0) ?>)</span>
          <span class="description">Check the box if you completed the habit for the selected date.</span>
        </li>
        <li><span class="category-title"><?= MainSheetConfig.headerLabels.buffer ?> (Column <?= DataHandler._cellToA1Notation(1, MainSheetConfig.bufferDataColumn).charAt(0) ?>)</span>
          <span class="description">Remaining buffer days for each habit. If a habit is missed, this decreases the *next* day. Reaching 0 and missing again breaks the streak. Buffers increase periodically based on your 'boost interval' setting.</span>
        </li>
         <li><span class="category-title"><?= MainSheetConfig.headerLabels.currentStreak ?> (Cell <?= MainSheetConfig.currentStreakCell ?>)</span>
          <span class="description">Consecutive days without failing the challenge (i.e., without missing a habit when its buffer was 0).</span>
        </li>
        <li><span class="category-title"><?= MainSheetConfig.headerLabels.highestStreak ?> (Cell <?= MainSheetConfig.highestStreakCell ?>)</span>
          <span class="description">Your longest recorded streak for this challenge.</span>
        </li>
        <li><span class="category-title"><?= MainSheetConfig.headerLabels.dateSelector ?> (Cell <?= MainSheetConfig.dateCell ?>)</span>
          <span class="description">Select a date (YYYY-MM-DD format or via date picker) to view or update data for that day. Valid range: from challenge start date to today.</span>
        </li>
      </ul>
      <hr>
      <h3>Example Habit Key</h3>
      <p>Below are examples of how emojis *could* represent habits. Define what works for you!</p>
      <!-- Example Key Items -->
       <div class="key-item">
           <span class="category-title">üèãÔ∏è Exercise</span>
           <span class="description">E.g., 20 min workout, 6k steps, or specific activity.</span>
       </div>
       <div class="key-item">
           <span class="category-title">üß¥ Routine</span>
           <span class="description">E.g., Skincare, medication, journaling.</span>
       </div>
       <div class="key-item">
           <span class="category-title">üåÆ Diet</span>
           <span class="description">E.g., No sugar, specific macros, mindful eating window.</span>
       </div>
       <div class="key-item">
           <span class="category-title">üíª Focus Work</span>
           <span class="description">E.g., 25 min coding, studying, deep work session.</span>
       </div>
       <div class="key-item">
           <span class="category-title">üìñ Learning/Reading</span>
           <span class="description">E.g., 20 min book reading, podcast, course module.</span>
       </div>
        <div class="key-item">
           <span class="category-title">üí§ Sleep</span>
           <span class="description">E.g., In bed by 11 PM, 7+ hours sleep.</span>
       </div>
        <div class="key-item">
           <span class="category-title">üíß Hydration</span>
           <span class="description">E.g., Drink X oz/liters of water.</span>
       </div>
       <!-- Add more examples as needed -->


    <? } else if (sheetName === HistorySheetConfig.sheetName) { ?>
      <h3>History Sheet Overview</h3>
      <p>This sheet logs your daily progress automatically. It is read-only and used by the script to calculate streaks and buffers.</p>
       <ul>
        <li><span class="category-title">Column A (Date)</span>
          <span class="description">The date for the logged data (YYYY-MM-DD).</span>
        </li>
        <li><span class="category-title">Column B (Completion Data)</span>
          <span class="description">Stored completion status (true/false/"" for each habit) for that day as a JSON list.</span>
        </li>
        <li><span class="category-title">Column C (Buffer Data)</span>
          <span class="description">Calculated buffer days remaining for each habit *at the end of* that day (after considering completion) as a JSON list.</span>
        </li>
         <li><span class="category-title">Column D (Current Streak)</span>
          <span class="description">The current streak *achieved on* that day.</span>
        </li>
        <li><span class="category-title">Column E (Highest Streak)</span>
          <span class="description">The highest streak recorded up to that day.</span>
        </li>
      </ul>

    <? } else { ?>
      <p>No specific help content available for this sheet ("<?= sheetName ?>") in Challenge Mode.</p>
    <? } ?>

  <? } else { ?>
     <p>Current application mode ('<?= mode ?>') is unrecognized or help content is unavailable.</p>
  <? } ?>

</body>
</html>
